{
  "id": "DIS-M002",
  "title": "DisplayInfo.getMetricsWithSize 中 densityDpi 計算錯誤",
  "domain": "display",
  "difficulty": "medium",
  "verified": true,
  "cts_test": "android.display.cts.DisplayTest#testGetMetrics",
  "cts_module": "CtsDisplayTestCases",
  "injection_point": "DIS-022",
  "injection_type": [
    "CALC"
  ],
  "affected_files": [
    "frameworks/base/core/java/android/view/DisplayInfo.java"
  ],
  "tags": [
    "display-info",
    "density-dpi",
    "off-by-one",
    "display-metrics",
    "getMetrics"
  ],
  "estimated_time_minutes": 20,
  "bug_description": "getMetricsWithSize 中 densityDpi 被錯誤地加 1",
  "root_cause": "在設定 outMetrics.densityDpi 時，誤將 logicalDensityDpi + 1 而非直接使用 logicalDensityDpi",
  "fix_approach": "將 logicalDensityDpi + 1 改為 logicalDensityDpi",
  "requires_permission": false,
  "call_chain": [
    "CTS: DisplayTest#testGetMetrics",
    "Display.getMetrics(outMetrics)                    [Display.java:1622]",
    "mDisplayInfo.getAppMetrics(outMetrics, adj)       [Display.java:1626]",
    "getMetricsWithSize(..., appWidth, appHeight)      [DisplayInfo.java:730]",
    "outMetrics.densityDpi = logicalDensityDpi + 1     [DisplayInfo.java:797] ← BUG"
  ],
  "version": "2025.06.14-3",
  "verification_status": "complete",
  "verification_date": "2026-02-21",
  "verification_issues": [],
  "cts_summary": {
    "passed": 0,
    "failed": 2,
    "total": 2
  }
}