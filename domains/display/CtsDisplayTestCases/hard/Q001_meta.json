{
  "id": "display-hard-001",
  "title": "Display Mode 偏好設定持久化失敗 - refreshRate 精度丟失",
  "difficulty": "hard",
  "domain": "display",
  "module": "CtsDisplayTestCases",
  "pattern": "C",
  "patternDesc": "跨檔案調用鏈 - A(DMS)→B(DisplayDevice)→C(PersistentDataStore)，問題在 C",
  "targetTests": [
    "android.display.cts.DefaultDisplayModeTest#testSetUserPreferredDisplayModeForSpecificDisplay"
  ],
  "callChain": [
    "DisplayManagerService.setUserPreferredDisplayModeInternal()",
    "DisplayDevice.setUserPreferredDisplayModeLocked()",
    "PersistentDataStore.setUserPreferredRefreshRate()"
  ],
  "bugFile": "frameworks/base/services/core/java/com/android/server/display/PersistentDataStore.java",
  "bugMethod": "DisplayState.setRefreshRate",
  "bugType": "precision_loss",
  "bootSafe": true,
  "expectedResult": {
    "outcome": "test_skipped",
    "failedTests": 0,
    "passedTests": 0,
    "skippedTests": 1,
    "errorMessage": "Need an Android TV device to run this test"
  },
  "timeLimit": 40,
  "hints": [
    "設定 API 沒報錯，說明前半段正常",
    "偏好設定需要持久化存儲",
    "注意數據類型轉換可能造成的精度丟失"
  ],
  "verified": true,
  "verifiedDate": "2025-02-09",
  "verifiedDevice": "Pixel 7 (27161FDH20031X)",
  "verificationStatus": "skipped",
  "verificationNotes": "Bug patch 可以成功套用到 PersistentDataStore.DisplayState.setRefreshRate()，但測試 DefaultDisplayModeTest#testSetUserPreferredDisplayModeForSpecificDisplay 需要 Android TV 設備才能運行。Pixel 7 手機設備被跳過。",
  "requiresSpecialConfig": true,
  "configRequirements": "需要 Android TV 設備",
  "affected_files": [
    "frameworks/base/services/core/java/com/android/server/display/PersistentDataStore.java",
    "frameworks/base/services/core/java/com/android/server/display/mode/DisplayModeDirector.java",
    "frameworks/base/core/java/android/view/DisplayInfo.java"
  ],
  "file_count": 3
}