{
  "id": "Q006",
  "title": "Brightness Zone Thermal Refresh Rate 配置錯誤",
  "difficulty": "hard",
  "category": "multi-file-interaction",
  "domain": "display",
  "subdomain": "refresh-rate-thermal",
  "estimated_time_minutes": 45,
  "files_involved": [
    {
      "path": "frameworks/base/services/core/java/com/android/server/display/mode/DisplayModeDirector.java",
      "role": "primary",
      "description": "Contains the buggy code in BrightnessObserver.onBrightnessChangedLocked()"
    },
    {
      "path": "frameworks/base/services/core/java/com/android/server/display/mode/SkinThermalStatusObserver.java",
      "role": "related",
      "description": "Provides findBestMatchingRefreshRateRange() method used by BrightnessObserver"
    },
    {
      "path": "frameworks/base/services/core/java/com/android/server/display/DisplayDeviceConfig.java",
      "role": "related",
      "description": "Provides thermal map configurations for low and high zones"
    }
  ],
  "bug_type": "copy-paste-error",
  "bug_description": "In the low brightness zone branch, the code incorrectly uses mHighZoneRefreshRateForThermals instead of mLowZoneRefreshRateForThermals when querying thermal refresh rate limits",
  "symptoms": [
    "High refresh rate maintained in low brightness + thermal throttling",
    "Increased battery consumption in low brightness scenarios",
    "Inconsistent behavior between low and high brightness zones"
  ],
  "cts_tests": [],
  "cts_tests_note": "NO CTS TEST AVAILABLE - RefreshRateTest does not exist, and CtsDisplayTestCases has no Thermal-related tests",
  "status": "NEEDS_REDESIGN",
  "status_reason": "This bug cannot be verified by any existing CTS test. The Brightness Zone + Thermal Throttling logic is internal to DisplayModeDirector and not exposed through CTS testing.",
  "verification_device": "Pixel 7",
  "keywords": [
    "BrightnessObserver",
    "refresh rate",
    "thermal throttling",
    "brightness zone",
    "DisplayModeDirector",
    "SkinThermalStatusObserver"
  ],
  "related_questions": [
    "Q003"
  ],
  "created_at": "2025-02-09",
  "updated_at": "2025-02-10",
  "version": "1.1",
  "available_cts_test_classes": [
    "android.display.cts.BrightnessTest",
    "android.display.cts.DefaultDisplayModeTest",
    "android.display.cts.DisplayEventTest",
    "android.display.cts.DisplayManagerTest",
    "android.display.cts.DisplayTest",
    "android.display.cts.HdrConversionDisabledTest",
    "android.display.cts.HdrConversionEnabledTest",
    "android.display.cts.VirtualDisplayConfigTest",
    "android.display.cts.VirtualDisplayTest"
  ],
  "redesign_suggestions": [
    "Option 1: Change bug to affect DefaultDisplayModeTest (user preferred refresh rate)",
    "Option 2: Change bug to affect DisplayTest (refresh rate switching)",
    "Option 3: Replace with a different bug that has CTS coverage",
    "Option 4: Create a custom verification script instead of relying on CTS"
  ],
  "affected_files": [
    "frameworks/base/services/core/java/com/android/server/display/mode/DisplayModeDirector.java",
    "frameworks/base/services/core/java/com/android/server/display/mode/Vote.java",
    "frameworks/base/services/core/java/com/android/server/display/DisplayDeviceConfig.java"
  ],
  "file_count": 3
}