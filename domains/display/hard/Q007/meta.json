{
  "id": "DIS-H007",
  "title": "Display Event DISPLAY_ADDED Not Delivered to Listeners",
  "domain": "display",
  "difficulty": "hard",
  "cts_test": "android.display.cts.DisplayTest#testMode",
  "cts_module": "CtsDisplayTestCases",
  "injection_point": "DIS-041",
  "injection_type": [
    "LOGIC",
    "FLAG_MISMATCH"
  ],
  "affected_files": [
    "frameworks/base/services/core/java/com/android/server/display/DisplayManagerService.java"
  ],
  "affected_methods": [
    "shouldSendEvent"
  ],
  "tags": [
    "display-event",
    "event-listener",
    "flag-mismatch",
    "event-filtering",
    "callback",
    "timeout"
  ],
  "estimated_time_minutes": 35,
  "skills_tested": [
    "Event callback 機制理解",
    "Flag 常數追蹤",
    "DisplayManager 事件分發流程"
  ],
  "hints": [
    "注意 shouldSendEvent() 中的 switch-case",
    "比較不同 EVENT 類型對應的 FLAG",
    "思考為什麼測試會超時"
  ],
  "bug_description": "shouldSendEvent() checks wrong flag for DISPLAY_ADDED events, causing them to be silently dropped",
  "root_cause": "EVENT_FLAG_DISPLAY_BRIGHTNESS checked instead of EVENT_FLAG_DISPLAY_ADDED (brightness not in default mask)",
  "fix_complexity": "Change flag constant in switch-case",
  "created_at": "2025-01-25T09:00:00+08:00",
  "updated_at": "2026-02-18T18:30:00+08:00",
  "verified": true,
  "verification_date": "2026-02-21",
  "verification_result": "PASS",
  "verification_notes": "測試在 addSecondaryDisplay() 中超時 (20s)，因為 onDisplayAdded callback 未被觸發",
  "verification_status": "complete",
  "verification_issues": [],
  "cts_summary": {
    "passed": 0,
    "failed": 2,
    "total": 2
  }
}