# DIS-H010: User Disabled HDR Types Not Stored Bug
# Target: frameworks/base/services/core/java/com/android/server/display/DisplayManagerService.java
# CTS Test: android.display.cts.DisplayTest#testSetUserDisabledHdrTypesStoresDisabledFormatsInSettings
# Expected Result: FAIL (Settings not updated with disabled HDR types)
#
# Bug Description:
# This patch adds an early return when userDisabledHdrTypes is non-empty,
# preventing the HDR types from being stored in Settings.Global.
# The CTS test verifies that disabled HDR types are persisted to settings.

--- a/frameworks/base/services/core/java/com/android/server/display/DisplayManagerService.java
+++ b/frameworks/base/services/core/java/com/android/server/display/DisplayManagerService.java
@@ -1322,6 +1322,12 @@ public final class DisplayManagerService extends SystemService {
                 return;
             }
 
+            // Bug: Skip storing non-empty arrays to "optimize" performance
+            // This prevents user HDR preferences from being persisted
+            if (userDisabledHdrTypes.length > 0) {
+                return;
+            }
+
             Arrays.sort(userDisabledHdrTypes);
             if (Arrays.equals(mUserDisabledHdrTypes, userDisabledHdrTypes)) {
                 return;
