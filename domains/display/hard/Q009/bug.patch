# DIS-H009: Mode Request Setting Return Value Inverted
# Target: frameworks/base/services/core/java/com/android/server/display/DisplayManagerService.java
# CTS Test: android.display.cts.DisplayTest#testModeSwitchOnPrimaryDisplay
# Expected Result: FAIL (assertTrue fails because getter returns false after setter(true))
#
# Bug Description:
# This patch negates the return value of shouldAlwaysRespectAppRequestedModeInternal().
# The test calls setShouldAlwaysRespectAppRequestedMode(true) then immediately
# verifies with assertTrue(shouldAlwaysRespectAppRequestedMode()). With this bug,
# the getter always returns the opposite of the actual state, causing assertion failure.

--- a/frameworks/base/services/core/java/com/android/server/display/DisplayManagerService.java
+++ b/frameworks/base/services/core/java/com/android/server/display/DisplayManagerService.java
@@ -2494,7 +2494,8 @@ public final class DisplayManagerService extends SystemService {
     }
 
     boolean shouldAlwaysRespectAppRequestedModeInternal() {
-        return mDisplayModeDirector.shouldAlwaysRespectAppRequestedMode();
+        // Bug: Inverted return value - getter returns opposite of actual state
+        return !mDisplayModeDirector.shouldAlwaysRespectAppRequestedMode();
     }
 
     void setRefreshRateSwitchingTypeInternal(@DisplayManager.SwitchingType int newValue) {
