# DIS-H004: Display Mode Alternative Refresh Rates 對稱性錯誤
# Target: frameworks/base/services/core/java/com/android/server/display/LocalDisplayAdapter.java
# CTS Test: android.display.cts.DisplayTest#testGetSupportedModesOnDefaultDisplay
# Expected Result: FAIL (alternativeRefreshRates symmetry check failed)
#
# Bug Description:
# This patch introduces an asymmetry in alternativeRefreshRates by only adding
# alternatives when j > i, breaking the bidirectional relationship that CTS expects.

--- a/services/core/java/com/android/server/display/LocalDisplayAdapter.java
+++ b/services/core/java/com/android/server/display/LocalDisplayAdapter.java
@@ -320,7 +320,10 @@ class LocalDisplayAdapter extends DisplayAdapter {
                 List<Float> alternativeRefreshRates = new ArrayList<>();
                 for (int j = 0; j < displayModes.length; j++) {
                     SurfaceControl.DisplayMode other = displayModes[j];
-                    boolean isAlternative = j != i && other.width == mode.width
+                    // BUG: Only consider modes with higher index as alternatives
+                    // This breaks symmetry: if A lists B as alternative,
+                    // B should also list A, but this condition prevents it
+                    boolean isAlternative = j > i && other.width == mode.width
                             && other.height == mode.height
                             && other.peakRefreshRate != mode.peakRefreshRate
                             && other.group == mode.group;
