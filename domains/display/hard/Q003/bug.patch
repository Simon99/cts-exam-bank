# DIS-H003: Display Mode Switch Rejection Bug
# Target: frameworks/base/services/core/java/com/android/server/display/LogicalDisplay.java
# CTS Test: android.display.cts.DisplayTest#testModeSwitchOnPrimaryDisplay
# Expected Result: FAIL (mode switch timeout - display stuck on default mode)
#
# Bug Description:
# This patch rejects mode switch requests when the target mode differs from
# the default mode. This prevents apps from switching display modes, causing
# mode switch tests to timeout waiting for the change.

--- a/services/core/java/com/android/server/display/LogicalDisplay.java
+++ b/services/core/java/com/android/server/display/LogicalDisplay.java
@@ -738,6 +738,14 @@ public final class LogicalDisplay {
      */
     public void setDesiredDisplayModeSpecsLocked(
             DisplayModeDirector.DesiredDisplayModeSpecs specs) {
+        // BUG: Reject mode changes that differ from default
+        // This prevents mode switching from working properly
+        if (specs != null && mBaseDisplayInfo != null) {
+            if (specs.baseModeId != mBaseDisplayInfo.defaultModeId) {
+                // Silently ignore non-default mode requests
+                return;
+            }
+        }
         mDesiredDisplayModeSpecs = specs;
     }
 
