diff --git a/frameworks/base/core/java/android/app/usage/StorageStatsManager.java b/frameworks/base/core/java/android/app/usage/StorageStatsManager.java
index abc1234..def5678 100644
--- a/frameworks/base/core/java/android/app/usage/StorageStatsManager.java
+++ b/frameworks/base/core/java/android/app/usage/StorageStatsManager.java
@@ -109,7 +109,8 @@ public class StorageStatsManager {
     @WorkerThread
     public @BytesLong long getTotalBytes(@NonNull UUID storageUuid) throws IOException {
         try {
-            return mService.getTotalBytes(convert(storageUuid), mContext.getOpPackageName());
+            // BUG: Wrong calculation - subtracting instead of returning directly
+            return mService.getTotalBytes(convert(storageUuid), mContext.getOpPackageName()) - mService.getFreeBytes(convert(storageUuid), mContext.getOpPackageName());
         } catch (ParcelableException e) {
             e.maybeRethrow(IOException.class);
             throw new RuntimeException(e);
diff --git a/frameworks/base/services/usage/java/com/android/server/usage/StorageStatsService.java b/frameworks/base/services/usage/java/com/android/server/usage/StorageStatsService.java
index 111222..333444 100644
--- a/frameworks/base/services/usage/java/com/android/server/usage/StorageStatsService.java
+++ b/frameworks/base/services/usage/java/com/android/server/usage/StorageStatsService.java
@@ -343,8 +343,9 @@ public class StorageStatsService extends IStorageStatsManager.Stub {
     public long getCacheQuotaBytes(String volumeUuid, int uid, String callingPackage) {
         enforceStatsPermission(Binder.getCallingUid(), callingPackage);
 
-        if (mCacheQuotas.containsKey(volumeUuid)) {
-            final SparseLongArray uidMap = mCacheQuotas.get(volumeUuid);
+        // BUG: Using packageName as key instead of volumeUuid
+        if (mCacheQuotas.containsKey(callingPackage)) {
+            final SparseLongArray uidMap = mCacheQuotas.get(callingPackage);
             return uidMap.get(uid, DEFAULT_QUOTA);
         }
 
diff --git a/frameworks/base/core/java/android/os/storage/StorageManager.java b/frameworks/base/core/java/android/os/storage/StorageManager.java
index 555666..777888 100644
--- a/frameworks/base/core/java/android/os/storage/StorageManager.java
+++ b/frameworks/base/core/java/android/os/storage/StorageManager.java
@@ -1553,8 +1553,9 @@ public class StorageManager {
         } else {
             // Else, linearly interpolate the amount of space to reserve
-            double slope = (cacheReservePercentHigh - cacheReservePercentLow) * totalBytes
-                    / (100.0 * (storageThresholdHighBytes - storageThresholdLowBytes));
+            // BUG: Numerator and denominator swapped, causing extreme values
+            double slope = (100.0 * (storageThresholdHighBytes - storageThresholdLowBytes))
+                    / ((cacheReservePercentHigh - cacheReservePercentLow) * totalBytes);
             double intercept = totalBytes * cacheReservePercentLow / 100.0
                     - storageThresholdLowBytes * slope;
             result = Math.round(slope * usableBytes + intercept);
